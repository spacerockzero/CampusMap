function detectHeight(e){return e.offsetHeight}function setHeight(e,t){e.style.height=t}function detectDevice(){var e=doc.body.offsetWidth;return e<800?0:1}function setDevice(e,t){var n=doc.getElementById("device_type"),r=doc.getElementsByTagName("body")[0];e===0?(control.currentDevice=0,r.setAttribute("id","mobile")):(control.currentDevice=1,r.setAttribute("id","desktop")),t&&typeof t=="function"&&t()}function toggleDevice(){var e=control.currentDevice;e===0?setDevice(1):setDevice(0)}function setCurrentDevice(){control.currentDevice===0?setDevice(0):setDevice(1)}function getMapHeight(){var e=detectHeight(body),t=detectHeight(doc.getElementById("title")),n=e-t+"px";return n}function setAllControls(){control.currentDevice=detectDevice(),setCurrentDevice(),setHeight(container,getMapHeight()),setHeight(canvas,getMapHeight())}function loadCategoryInfoFile(e){$.ajax({dataType:"json",url:categoryFile,success:function(e){categoryInfo=e}}).done(e).fail(function(){console.log("category ajax error")})}function loadCategoryFile(e){$.ajax({dataType:"json",url:objectFile,success:function(e){console.log("successfully pulled json categories"),mapCategories=e}}).done(e).fail(function(){console.log("objects ajax error")})}function loadCatData(e){loadCategoryInfoFile(),loadCategoryFile(),e&&typeof e=="function"&&e()}function loadProgress(e,t){var n=doc.getElementById("loading_progress");n.style.width=e+"%",console.log("Loaded "+e),t&&typeof t=="function"&&t()}function loadComplete(e){loadProgress(100);var t=$("#loading"),n=control.currentDevice,r=$("#menu_button");t.fadeOut(1e3),e&&typeof e=="function"&&e(),console.timeEnd("initialize js chain until ready")}function createMarker(e,t,n,r){var i=new google.maps.Marker({position:new google.maps.LatLng(e,t),visible:!1,map:map,title:n,icon:r});return i}function buildCatObject(e,t,n,r){var i="";return i+='<a id="obj_'+t+"-"+e+'" class="object marker_object" name="'+n+'" href="#">',i+='<img  class="obj_icon" src="img/icons/numeral-icons/'+r+"/"+(e+1)+'.png" alt="'+n+'" />',i+='<div class="object_name">'+n+"</div>",i+="</a>",i}function createInfoWindow(e,t,n){google.maps.event.addListener(e,"click",function(){var r="",i=t.name,s,o=t.link,u=t.hours,a=t.phone,f=t.address,l=t.info,c=control.currentDevice;t.img&&(t.img.indexOf(":")===-1?s="img/objects/"+n+"/"+t.img:s=t.img),r+='<div class="infopane',c===0?r+=' infopane-mobile">':r+=' infopane-desktop">',r+="<h2>"+i+"</h2>",r+="<div>",s&&(r+='<img src="'+s+'" alt="'+i+'"',c===0?r+='width="100" height="75"':r+='width="200" height="150"',r+='style="float:right;margin:0 0 10px 10px"/>'),r+='<div class="button-div">',a&&(r+='<a class="phone-call btn btn-large btn-primary icon-phone" href="tel:'+a+'" ></a>'),o&&(r+='<a href="'+o+'" class="btn btn-large btn-primary">More Info</a>'),r+="</div>",u&&(r+='<div class="info-row info-hours"><strong>Hours:</strong> '+u+"</div>"),a&&(r+='<div class="info-row info-phone"><strong>Phone:</strong> '+a+"</div>"),f&&(r+='<div class="info-row info-address"><strong>Address:</strong> '+f+"</div>"),l&&(r+='<div class="info-row info-info"><strong>Info:</strong> '+l+"</div>"),r+="</div>",infoWindow.setContent(r),infoWindow.open(map,e)})}function displayPoint(e){var t=google.maps.event.addListener(map,"moveend",function(){var n=map.fromLatLngToDivPixel(e.getPosition());google.maps.event.removeListener(t)});map.panTo(e.getPosition()),google.maps.event.trigger(e,"click")}function populateCategoryInfo(e){var t=doc.getElementById("categories"),n="",r=categoryInfo.length,i,s,o=0,u;while(o<r)i=categoryInfo[o],n+='<div class="category" id="cat_'+o+'">',categoryInfo[o].type===0?n+='<a class="category_bar" href="#" >':n+='<a class="category_bar cat_polygon" href="#" >',n+='<img class="cat_icon" src="img/icons/blank-colors/'+i.icon+'.png" />',n+='<span class="category_name">'+i.title+"</span>",n+="</a>",n+='<div class="cat_container">',n+='<div class="cat_info">',n+="<p>",n+=i.text,n+="</p>",n+='<a href="'+i.link+'">'+i.title+" website</a>",n+="</div>",n+='<div id="category_'+o+'"></div>',n+="</div>",n+="</div>",control.categoryState[o]=0,o+=1;t.innerHTML=n,e&&typeof e=="function"&&e()}function populateObjectCategory(e,t){var n=document.getElementById("category_"+e),r="",i=categoryInfo[e],s=i.name,o=mapCategories[e],u=markerArray,a=[],f=i.icon,l,c=o.length,h=0,p,d,v,m,g;while(h<c)p=o[h],d=p.name,v=p.lat,m=p.lon,l=iconpath+f+"/"+(h+1)+".png",g=createMarker(v,m,d,l),r+=buildCatObject(h,e,d,f),createInfoWindow(g,p,s),a.push(g),h+=1;n.innerHTML=r,u[e]=a,t&&typeof t=="function"&&t()}function populatePolygonCategory(e,t){var n=document.getElementById("category_"+e),r="",i=categoryInfo[e],s=mapCategories[e],o,u,a=s.length,f=0,l,c,h,p=[];while(f<a)o=s[f],r+='<a class="object polygon" id="layer_cat_'+f+'" href="#">',r+='<div class="polygon_key" id="poly_'+o.name+'" style="border-color:'+o.borderColor+"; background-color:"+o.fillColor+'">&nbsp;</div>',r+='<div class="object_name polygon">'+o.name+"</div>",r+="</a>",h=mapCategories[e][f].map,c=new google.maps.KmlLayer(h,{suppressInfoWindows:!1,preserveViewport:!0}),p.push(c),f+=1;markerArray[e]=p,n.innerHTML=r,t&&typeof t=="function"&&t()}function toggleMarkerVisibility(e,t){var n=markerArray[e],r=n.length,i=0;if(t===1)while(i<r)n[i].setVisible(!0),i+=1;else while(i<r)n[i].setVisible(!1),i+=1}function togglePolygonVisibility(e,t,n,r){var i=markerArray[t][n],s=e.hasClass("active_polygon");s===!0?(i.setMap(null),e.toggleClass("active_polygon")):(i.setMap(map),e.toggleClass("active_polygon")),r&&typeof r=="function"&&r()}function setOptions(){myLatlng=new google.maps.LatLng(43.815045,-111.783515),myOptions={zoom:16,center:myLatlng,mapTypeId:google.maps.MapTypeId.HYBRID,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.TERRAIN]}}}function setMap(){map=new google.maps.Map(doc.getElementById("map_canvas"),myOptions)}function setInfoWindow(){infoWindow=new google.maps.InfoWindow}function setCampusLayer(){campusLayer=new google.maps.KmlLayer(campusFile,{suppressInfoWindows:!0,map:map,preserveViewport:!0,zoom:18}),campusLayer.setMap(map)}function runPopulators(e){var t=0,n=categoryInfo.length,r;while(t<n)r=categoryInfo[t].type,r===0?populateObjectCategory(t):r===1&&populatePolygonCategory(t),t+=1;e&&typeof e=="function"&&e()}function setMenu(e){var t=doc.getElementById("menu"),n=doc.getElementById("notification"),r=control.currentDevice;r!==0&&(t=$("#menu"),n=$("#notification")),e===0?(r===0?(t.style.display="none",n.style.display="block"):(t.stop().fadeOut(300),n.stop().fadeIn(300)),control.menuState=0):(r===0?(t.style.display="block",n.style.display="none"):(t.stop().fadeIn(300),n.stop().fadeOut(300)),control.menuState=1)}function toggleMenu(){var e=control.menuState;e===0?setMenu(1):setMenu(0)}function bindCategoryToggle(e){$(".category_bar").on("click",function(){console.time("clickCategory"),infoWindow.close();var e=control.currentDevice,t=this.parentNode,n=t.id.substr(4),r=control.categoryState[n],i=t.children[1],s=i.style.display,o=$(this).hasClass("cat_polygon");e===1&&(i=$(this).next("div"),console.log(i)),r===0?(e===0?i.style.display="block":i.slideToggle(200),o===!1&&toggleMarkerVisibility(n,1),r=1):(e===0?i.style.display="none":i.slideToggle(200),o===!1&&toggleMarkerVisibility(n,0),r=0),control.categoryState[n]=r,console.timeEnd("clickCategory")}),e&&typeof e=="function"&&e()}function bindPolygonToggle(e){$(".object.polygon").click(function(e){e.stopPropagation();var t=$(this),n=t.parent().attr("id").substr(9),r=t.attr("id").substr(10);togglePolygonVisibility(t,n,r)}),e()}function bindMenuObjects(e){$(".object.marker_object").click(function(e){e.stopPropagation();var t=this,n=t.id.charAt(4),r=t.id.substr(6),i=markerArray[n][r],s=control.currentDevice;displayPoint(i),s===0&&setMenu(0)}),e&&typeof e=="function"&&e()}function typeToggle(e){google.maps.event.addListener(map,"maptypeid_changed",function(){document.getElementById("notification").className=map.getMapTypeId()}),e&&typeof e=="function"&&e()}function initialize(e){console.time("initialize js chain until ready"),setOptions(),setAllControls(),setMap(),loadProgress(10),setInfoWindow(),setCampusLayer(),loadProgress(80),loadCategoryInfoFile(function(){populateCategoryInfo(function(){loadCategoryFile(function(){runPopulators(function(){bindCategoryToggle(function(){bindPolygonToggle(function(){bindMenuObjects(function(){typeToggle(function(){google.maps.event.addListenerOnce(map,"tilesloaded",function(){loadComplete()})})})})})})})})}),e&&typeof e=="function"&&e()}function resizeStack(){var e=control.currentDevice;e===1?(setHeight(container,getMapHeight()),setHeight(canvas,getMapHeight()),setDevice(detectDevice())):(setHeight(container,getMapHeight()),setHeight(canvas,getMapHeight()),setDevice(detectDevice()))}var doc=document,win=window,$doc=$(document),$win=$(window),container=doc.getElementById("container"),body=doc.getElementsByTagName("body")[0],canvas=doc.getElementById("map_canvas"),doResize,categoryFile="data/categories.txt",objectFile="data/objectFileExperiment.txt",myLatlng,myOptions,map,parkingLayer,infoWindow,iconpath="img/icons/numeral-icons/",campusLayer,campusFile="http://www2.byui.edu/Map/campus_outline.xml",control={menuState:0,currentDevice:0,categoryState:[]},categoryInfo=[],mapCategories=[],markerArray=[];$win.resize(function(){clearTimeout(doResize),doResize=setTimeout(function(){resizeStack()},100)}),$win.load(function(){initialize(),$("#map_canvas").click(function(e){e.stopPropagation(),$(this)!==$("#menu_button")&&setMenu(0)}),$(document).keydown(function(e){e.keyCode===32&&toggleMenu()})});