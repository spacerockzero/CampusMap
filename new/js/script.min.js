function detectHeight(e){return e.offsetHeight}function setHeight(e,t){e.style.height=t}function detectDevice(){var e=doc.body.offsetWidth;return e<800?0:1}function setDevice(e,t){var n=doc.getElementById("device_type"),r=doc.getElementsByTagName("body")[0];e===0?(control.currentDevice=0,r.setAttribute("id","mobile")):(control.currentDevice=1,r.setAttribute("id","desktop")),t}function toggleDevice(){var e=control.currentDevice;e===0?setDevice(1):setDevice(0)}function setCurrentDevice(){control.currentDevice===0?setDevice(0):setDevice(1)}function getMapHeight(){var e=detectHeight(body),t=57,n=e-t+"px";return n}function setAllControls(){control.currentDevice=detectDevice(),setCurrentDevice(),setHeight(container,getMapHeight()),setHeight(canvas,getMapHeight())}function loadCategoryInfoFile(e){$.ajax({dataType:"json",url:categoryFile,success:function(e){categoryInfo=e}}).done(e)}function loadCategoryFile(e){$.ajax({dataType:"json",url:objectFile,success:function(e){mapCategories=e}}).done(e).fail(function(){console.log("ajax error")})}function loadCatData(e){loadCategoryInfoFile(),loadCategoryFile(),e}function loadProgress(e){var t=doc.getElementById("loading_progress");t.style.width=e+"%"}function loadComplete(e){loadProgress(100);var t=$("#loading"),n=control.currentDevice,r=$("#menu_button");t.fadeOut(1e3),r.fadeIn(1e3),e}function createMarker(e,t,n,r){var i=new google.maps.Marker({position:new google.maps.LatLng(e,t),visible:!1,map:map,title:n,icon:r});return i}function buildCatObject(e,t,n,r){var i="";return i+='<a id="obj_'+t+"-"+e+'" class="object marker_object" name="'+n+'" href="#">',i+='<img  class="obj_icon" src="img/icons/numeral-icons/'+r+"/"+(e+1)+'.png" alt="'+n+'" height="25" width="22">',i+='<div class="object_name">'+n+"</div>",i+="</a>",i}function createInfoWindow(e,t,n){google.maps.event.addListener(e,"mousedown",function(){var r="",i=t.name,s,o=t.info,u=t.link,a=control.currentDevice;t.img&&(t.img.indexOf(":")===-1?s="img/objects/"+n+"/"+t.img:s=t.img),r+='<div class="infopane">',r+="<h2>"+i+"</h2>",r+="<div>",s&&(r+='<img src="'+s+'" alt="'+i+'"',a===0?r+='width="100" height="75"':r+='width="200" height="150"',r+='style="float:right;margin:0 0 10px 10px"/>'),o&&(r+=o),u&&(r+='<br/><br/><a href="'+u+'" target="_blank">More information about '+i+" on the web</a>"),r+="</div>",infoWindow.setContent(r),infoWindow.open(map,e)})}function displayPoint(e){var t=google.maps.event.addListener(map,"moveend",function(){var n=map.fromLatLngToDivPixel(e.getPosition());google.maps.event.removeListener(t)});map.panTo(e.getPosition()),google.maps.event.trigger(e,"mousedown")}function populateCategoryInfo(e){var t=doc.getElementById("categories"),n="",r=categoryInfo.length,i,s,o=0,u;while(o<r)i=categoryInfo[o],n+='<div class="category" id="cat_'+o+'">',categoryInfo[o].type===0?n+='<a class="category_bar" href="#" >':n+='<a class="category_bar cat_polygon" href="#" >',n+='<img class="cat_icon" src="img/icons/blank-colors/'+i.icon+'.png" height="25" width="22"/>',n+='<span class="category_name">'+i.title+"</span>",n+="</a>",n+='<div class="cat_container">',n+='<div class="cat_info">',n+="<p>",n+=i.text,n+="</p>",n+='<a href="'+i.link+'">'+i.title+" website</a>",n+="</div>",n+='<div id="category_'+o+'"></div>',n+="</div>",n+="</div>",control.categoryState[o]=0,o+=1;t.innerHTML=n,e()}function populateObjectCategory(e){var t=document.getElementById("category_"+e),n="",r=categoryInfo[e],i=r.name,s=mapCategories[e],o=markerArray,u=[],a=r.icon,f,l=s.length,c=0,h,p,d,v,m;while(c<l)h=s[c],p=h.name,d=h.lat,v=h.lon,f=iconpath+a+"/"+(c+1)+".png",m=createMarker(d,v,p,f),n+=buildCatObject(c,e,p,a),createInfoWindow(m,h,i),u.push(m),c+=1;t.innerHTML=n,o[e]=u}function populatePolygonCategory(e,t){var n=document.getElementById("category_"+e),r="",i=categoryInfo[e],s=mapCategories[e],o,u,a=s.length,f=0,l,c,h,p=[];while(f<a)o=s[f],r+='<a class="object polygon" id="layer_cat_'+f+'" href="#">',r+='<div class="polygon_key" id="poly_'+o.name+'" style="border-color:'+o.borderColor+"; background-color:"+o.fillColor+'">&nbsp;</div>',r+='<div class="object_name polygon">'+o.name+"</div>",r+="</a>",h=mapCategories[e][f].map,c=new google.maps.KmlLayer(h,{suppressInfoWindows:!1,preserveViewport:!0}),p.push(c),f+=1;markerArray[e]=p,n.innerHTML=r,t}function toggleMarkerVisibility(e,t){var n=markerArray[e],r=n.length,i=0;if(t===1)while(i<r)n[i].setVisible(!0),i+=1;else while(i<r)n[i].setVisible(!1),i+=1}function togglePolygonVisibility(e,t,n,r){var i=markerArray[t][n],s=e.hasClass("active_polygon");s===!0?(i.setMap(null),e.toggleClass("active_polygon")):(i.setMap(map),e.toggleClass("active_polygon")),r}function setOptions(){myLatlng=new google.maps.LatLng(43.815045,-111.783515),myOptions={zoom:16,center:myLatlng,mapTypeId:google.maps.MapTypeId.HYBRID,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.TERRAIN]}}}function setMap(){map=new google.maps.Map(doc.getElementById("map_canvas"),myOptions)}function setInfoWindow(){infoWindow=new google.maps.InfoWindow}function setCampusLayer(){campusLayer=new google.maps.KmlLayer(campusFile,{suppressInfoWindows:!0,map:map,preserveViewport:!0,zoom:18}),campusLayer.setMap(map)}function runPopulators(e){var t=0,n=categoryInfo.length,r;while(t<n)r=categoryInfo[t].type,r===0?populateObjectCategory(t):r===1&&populatePolygonCategory(t),t+=1;e()}function setMenu(e){var t=doc.getElementById("menu"),n=doc.getElementById("notification"),r=control.currentDevice;r!==0&&(t=$("#menu"),n=$("#notification")),e===0?(r===0?(t.style.display="none",n.style.display="block"):(t.stop().fadeOut(300),n.stop().fadeIn(300)),control.menuState=0):(r===0?(t.style.display="block",n.style.display="none"):(t.stop().fadeIn(300),n.stop().fadeOut(300)),control.menuState=1)}function toggleMenu(){var e=control.menuState;e===0?setMenu(1):setMenu(0)}function bindCategoryToggle(e){$(".category_bar").mousedown(function(){console.time("clickCategory"),infoWindow.close();var e=control.currentDevice,t=this.parentNode,n=t.id.substr(4),r=control.categoryState[n],i=t.children[1],s=i.style.display,o=$(this).hasClass("cat_polygon");e===1&&(i=$(this).parent().find(".cat_container")),r===0?(r=1,e===0?i.style.display="block":i.slideToggle(200),o===!1&&toggleMarkerVisibility(n,1)):(r=0,e===0?i.style.display="none":i.slideToggle(200),o===!1&&toggleMarkerVisibility(n,0)),control.categoryState[n]=r,console.timeEnd("clickCategory")}),e()}function bindPolygonToggle(e){$(".object.polygon").mousedown(function(e){e.stopPropagation();var t=$(this),n=t.parent().attr("id").substr(9),r=t.attr("id").substr(10);togglePolygonVisibility(t,n,r)}),e()}function bindMenuObjects(e){$(".object.marker_object").mousedown(function(e){e.stopPropagation();var t=this,n=t.id.charAt(4),r=t.id.substr(6),i=markerArray[n][r],s=control.currentDevice;displayPoint(i),s===0&&setMenu(0)}),e()}function zoomToggle(e){google.maps.event.addListener(map,"zoom_changed",function(){var e=map.getZoom();e>=17?map.setMapTypeId(google.maps.MapTypeId.ROADMAP):map.setMapTypeId(google.maps.MapTypeId.HYBRID)}),e()}function initialize(e){setOptions(),setAllControls(),setMap(),loadProgress(10),setInfoWindow(),setCampusLayer(),loadCategoryInfoFile(function(){populateCategoryInfo(function(){loadCategoryFile(function(){runPopulators(function(){bindCategoryToggle(function(){bindPolygonToggle(function(){bindMenuObjects(function(){zoomToggle(function(){loadComplete()})})})})})})})}),loadProgress(90),e}function resizeStack(){var e=control.currentDevice;setHeight(container,getMapHeight()),setHeight(canvas,getMapHeight()),setDevice(detectDevice())}var doc=document,win=window,$doc=$(document),$win=$(window),container=doc.getElementById("container"),body=doc.getElementsByTagName("body")[0],canvas=doc.getElementById("map_canvas"),doResize,categoryFile="data/categories.txt",objectFile="data/objectFile.txt",myLatlng,myOptions,map,parkingLayer,infoWindow,iconpath="img/icons/numeral-icons/",campusLayer,campusFile="http://www2.byui.edu/Map/campus_outline.xml",control={menuState:0,currentDevice:0,categoryState:[]},categoryInfo=[],mapCategories=[],markerArray=[];$win.resize(function(){clearTimeout(doResize),doResize=setTimeout(function(){resizeStack()},100)}),$win.load(function(){initialize(),$("#map_canvas").click(function(e){e.stopPropagation(),$(this)!==$("#menu_button")&&setMenu(0)}),$(document).keydown(function(e){e.keyCode===32&&toggleMenu()})});