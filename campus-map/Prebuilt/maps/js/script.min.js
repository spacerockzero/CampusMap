var doc=document,win=window,$doc=$(document),$win=$(window),container=doc.getElementById("container"),body=doc.getElementsByTagName("body")[0],canvas=doc.getElementById("map_canvas"),doResize,categoryFile="Prebuilt/maps/data/categories.txt",objectFile="Prebuilt/maps/data/objectFile.txt",myLatlng,myOptions,map,parkingLayer,infoWindow,iconpath="Prebuilt/maps/imgs/icons/numeral-icons/",campusLayer,campusFile="http://www.byui.edu/Prebuilt/maps/campus_outline.xml",control={menuState:1,currentDevice:0, categoryState:[]},categoryInfo=[],mapCategories=[],fullMapCategories=[],markerArray=[];function getHeight(a){return a.height()}function setHeight(a,d){a.style.height=d}function getMapHeight(){var a=$("body").height(),d=$("#title").height();return a-d+"px"}function setMapHeight(){$("#container").height(getMapHeight());$("#map_canvas").height(getMapHeight())}function detectDevice(){return 800>doc.body.offsetWidth?0:1} function setDevice(a,d){doc.getElementById("device_type");var c=doc.getElementsByTagName("body")[0];0===a?(control.currentDevice=0,c.setAttribute("id","mobile")):(control.currentDevice=1,c.setAttribute("id","desktop"));setMapHeight();d&&"function"===typeof d&&d()}function toggleDevice(){0===control.currentDevice?setDevice(1):setDevice(0)}function setCurrentDevice(){0===control.currentDevice?setDevice(0):setDevice(1)} function setAllControls(){var a=detectDevice();control.currentDevice=a;setCurrentDevice();resizeStack()}function loadCategoryInfoFile(a){$.ajax({dataType:"json",url:categoryFile,success:function(a){categoryInfo=a}}).done(a).fail(function(){})}function loadCategoryFile(a){$.ajax({dataType:"json",url:objectFile,success:function(a){mapCategories=a;fullMapCategories=$.extend(!0,[],mapCategories)}}).done(a).fail(function(){})} function loadCatData(a){loadCategoryInfoFile();loadCategoryFile();a&&"function"===typeof a&&a()}function loadProgress(a,d){doc.getElementById("loading_progress").style.width=a+"%";d&&"function"===typeof d&&d()}function loadComplete(a){loadProgress(100);$("#loading").fadeOut(1E3);a&&"function"===typeof a&&a();console.timeEnd("initialize js chain until ready")}function createMarker(a,d,c,b){return new google.maps.Marker({position:new google.maps.LatLng(a,d),visible:!1,map:map,title:c,icon:b})} function buildCatObject(a,d,c,b,e){a=""+('<a id="obj_'+d+"-"+a+'" class="object marker_object" name="'+c+'" href="#'+e+'">')+('<img class="obj_icon" src="Prebuilt/maps/imgs/icons/numeral-icons/'+b+"/"+(a+1)+'.png" alt="'+c+'" />');a+='<div class="object_name">'+c+"</div>";return a+="</a>"} function createInfoWindow(a,d,c){google.maps.event.addListener(a,"click",function(){var b="",e=d.name,f,h=d.link,k=d.hours,g=d.phone,m=d.address,n=d.info,l=control.currentDevice;d.img&&(f=-1===d.img.indexOf(":")?"Prebuilt/maps/imgs/objects/"+c+"/"+d.img:d.img);b+='<div class="infopane';b=(0===l?b+' infopane-mobile">':b+' infopane-desktop">')+("<h2>"+e+"</h2>");b+="<div>";f&&(b+='<img src="'+f+'" alt="'+e+'"',b=0===l?b+'width="100" height="75"':b+'width="200" height="150"',b+='style="float:right;margin:0 0 10px 10px"/>'); b+='<div class="button-div">';g&&(b+='<a class="phone-call btn btn-large btn-primary icon-call" href="tel:'+g+'" ></a>');h&&(b+='<a href="'+h+'" target="_blank" class="btn btn-large btn-primary">More Info</a>');b+="</div>";k&&(b+='<div class="info-row info-hours"><strong>Hours:</strong> '+k+"</div>");g&&(b+='<div class="info-row info-phone"><strong>Phone:</strong> '+g+"</div>");m&&(b+='<div class="info-row info-address"><strong>Address:</strong> '+m+"</div>");n&&(b+='<div class="info-row info-info"><strong>Info:</strong> '+ n+"</div>");b+="</div>";b+="</div>";b+='<div class="addthis_toolbox addthis_32x32_style addthis_default_style">';b+="<p>Share this location.</p>";b+='<a class="addthis_button_facebook social_button"></a>';b+='<a class="addthis_button_google_plusone_share social_button"></a>';b+='<a class="addthis_button_twitter social_button"></a>';b+='<a class="addthis_button_compact social_button"></a>';b+="</div>";infoWindow.setContent(b);infoWindow.open(map,a);addthis.toolbox(".addthis_toolbox",{},{url:"http://www2.byui.edu/Maps/campus-map/index.html#"+ d.code,title:d.name})})}function displayPoint(a){var d=google.maps.event.addListener(map,"moveend",function(){map.fromLatLngToDivPixel(a.getPosition());google.maps.event.removeListener(d)});map.panTo(a.getPosition());google.maps.event.trigger(a,"click")} function populateCategoryInfo(a){for(var d=doc.getElementById("categories"),c="",b=doc.getElementById("map_keys"),e=categoryInfo.length,f,h=0;h<e;)f=categoryInfo[h],c+='<div class="category" id="cat_'+h+'">',0===categoryInfo[h].type?c+='<a class="category_bar" href="#" >':(c+='<a class="category_bar cat_polygon" href="#" >',b.innerHTML+='<div id="poly_key_'+h+'" class="map_key_category map_key_'+f.name+'"><div class="key_title">'+f.name+' Map Key</div><a href="#" class="close icon-cancel nolink"></a></div>'), c+='<img class="cat_icon" src="Prebuilt/maps/imgs/icons/blank-colors/'+f.icon+'.png" />',c+='<span class="category_name">'+f.title+"</span>",c+="</a>",c+='<div class="cat_container">',c+='<div class="cat_info">',c+="<p>",c+=f.text,c+="</p>",c+='<a href="'+f.link+'" target="_blank">'+f.title+" website</a>",c+="</div>",c+='<div id="category_'+h+'"></div>',c+="</div>",c+="</div>",control.categoryState[h]=0,h+=1;d.innerHTML=c;a&&"function"===typeof a&&a()} function populateObjectCategory(a,d){for(var c=document.getElementById("category_"+a),b="",e=categoryInfo[a],f=e.name,h=mapCategories[a],k=markerArray,g=[],e=e.icon,m,n=h.length,l=0,p,q,r,s;l<n;)p=h[l],q=p.name,r=p.lat,s=p.lon,m=iconpath+e+"/"+(l+1)+".png",code=p.code,m=createMarker(r,s,q,m),b+=buildCatObject(l,a,q,e,code),createInfoWindow(m,p,f),g.push(m),l+=1;c.innerHTML=b;k[a]=g;d&&"function"===typeof d&&d()} function populatePolygonCategory(a,d){for(var c=doc.getElementById("category_"+a),b="",e=mapCategories[a],f=$(".map_key_"+categoryInfo[a].name),h=f.html(),k="",g,m=e.length,n=0,l=[];n<m;)g=e[n],b+='<a class="object polygon" id="layer_cat_'+n+'" href="#'+g.code+'">',b+='<div class="polygon_key" id="poly_'+g.name+'" style="border-color:'+g.borderColor+"; background-color:"+g.fillColor+'"><span>&nbsp;</span></div>',b+='<div class="object_name polygon">'+g.name+"</div>",b+="</a>",k+='<div class="polygon_key" id="poly_key_'+ g.code+'" style="border-color:'+g.borderColor+"; background-color:"+g.fillColor+'">'+g.code+"</div>",g=g.map,g=new google.maps.KmlLayer(g,{suppressInfoWindows:!1,preserveViewport:!0}),l.push(g),n+=1;markerArray[a]=l;c.innerHTML=b;f.html(h+k);d&&"function"===typeof d&&d()}function toggleMarkerVisibility(a,d){var c=markerArray[a],b=c.length,e=0;if(1===d)for(;e<b;)c[e].setVisible(!0),e+=1;else for(;e<b;)c[e].setVisible(!1),e+=1} function togglePolygonVisibility(a,d,c,b){a=a.find("span");var e=markerArray[d][c];c=mapCategories[d][c].code;d=$(".map_key_"+categoryInfo[d].name);c=$("#map_keys #poly_key_"+c);!0===a.hasClass("icon-checkmark")?(e.setMap(null),a.stop().toggleClass("icon-checkmark"),c.stop().toggleClass("active_key"),1>d.children(".active_key").length&&d.hide()):(e.setMap(map),a.stop().toggleClass("icon-checkmark"),d.show(),c.toggleClass("active_key"));b&&"function"===typeof b&&b()} function togglePolyKey(a){$(".map_key_"+categoryInfo[a].name).stop().fadeToggle()}function setOptions(){myLatlng=new google.maps.LatLng(43.815045,-111.783515);myOptions={zoom:16,center:myLatlng,mapTypeId:google.maps.MapTypeId.HYBRID,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.TERRAIN]}}}function setMap(){map=new google.maps.Map(doc.getElementById("map_canvas"),myOptions)} function setInfoWindow(){infoWindow=new google.maps.InfoWindow}function setCampusLayer(){campusLayer=new google.maps.KmlLayer(campusFile,{suppressInfoWindows:!0,map:map,preserveViewport:!0,zoom:18});campusLayer.setMap(map)}function runPopulators(a){for(var d=0,c=categoryInfo.length,b;d<c;)b=categoryInfo[d].type,0===b?populateObjectCategory(d):1===b&&populatePolygonCategory(d),d+=1;a&&"function"===typeof a&&a()} function setMenu(a){var d=doc.getElementById("menu"),c=doc.getElementById("notification"),b=control.currentDevice;0!==b&&(d=$("#menu"),c=$("#notification"));0===a?(0===b?(d.style.display="none",c.style.display="block"):(d.stop().fadeOut(300),c.stop().fadeIn(300)),control.menuState=0):(0===b?(d.style.display="block",c.style.display="none"):(d.stop().fadeIn(300),c.stop().fadeOut(300)),control.menuState=1)}function toggleMenu(){0===control.menuState?setMenu(1):setMenu(0)} function bindCategoryToggle(a){$(".category_bar").on("click",function(a){a.preventDefault();openCategory(this)});a&&"function"===typeof a&&a()} function openCategory(a){infoWindow.close();var d=control.currentDevice,c=a.parentNode,b=c.id.substr(4),e=control.categoryState[b],c=c.children[1],f=$(a).hasClass("cat_polygon");1===d&&(c=$(a).next("div"));0===e?(0===d?c.style.display="block":c.slideToggle(200),!1===f&&toggleMarkerVisibility(b,1),e=1):(0===d?c.style.display="none":c.slideToggle(200),!1===f&&toggleMarkerVisibility(b,0),e=0);control.categoryState[b]=e} function bindPolygonToggle(a){$(".object.polygon").click(function(a){a.stopPropagation();openPolygon(this)});$(".close").click(function(a){a.stopPropagation();a.preventDefault();a=$(this).parent().attr("id").substr(9);togglePolyKey(a)});a&&"function"===typeof a&&a()}function openPolygon(a){a=$(a);var d=a.parent().attr("id").substr(9),c=a.attr("id").substr(10);togglePolygonVisibility(a,d,c)} function bindMenuObjects(a){$(".object.marker_object").click(function(a){a.stopPropagation();openObject(this)});a&&"function"===typeof a&&a()}function openObject(a){var d=a.id.charAt(4);a=a.id.substr(6);var c=control.currentDevice;displayPoint(markerArray[d][a]);0===c&&setMenu(0)}function typeToggle(a){google.maps.event.addListener(map,"maptypeid_changed",function(){document.getElementById("notification").className=map.getMapTypeId()});a&&"function"===typeof a&&a()} function bindSearch(a){$("#object_search input").keyup(function(){performSearch(this.value.toLowerCase())});$("#object_search span").click(function(){$("#object_search input").val("");performSearch("");$("#object_search input").focus()});a&&"function"===typeof a&&a()} function performSearch(a){if(""!=a){for(var d=mapCategories=$.extend(!0,[],fullMapCategories),c=0,b=d.length;c<b;c++)for(var e=0,f=d[c].length;e<f;e++)-1===d[c][e].name.toLowerCase().indexOf(a)&&(d[c].splice(e,1),f--,e--);clearAllMarkers();runPopulators(function(){bindPolygonToggle(function(){bindMenuObjects()})});openAllCategories()}else $(".object.polygon span").removeClass("icon-checkmark"),mapCategories=fullMapCategories,clearAllMarkers(),runPopulators(function(){bindPolygonToggle(function(){bindMenuObjects()})}), $(".category_bar").each(function(){var a=this.parentNode.id.substr(4);1===control.categoryState[a]&&openCategory(this)})}function openAllCategories(a){$(".category_bar").each(function(){var a=mapCategories,c=this.parentNode.id.substr(4),b=control.categoryState[c];0!==a[c].length?0===b?openCategory(this):$(this).hasClass("cat_polygon")?$(".object.polygon").each(function(){var a=this.id.substr(10);togglePolygonVisibility($(this),c,a)}):toggleMarkerVisibility(c,1):1===b&&openCategory(this)})} function clearAllMarkers(a){a=markerArray;$("#map_keys .polygon_key").remove();for(var d=0,c=a.length;d<c;d++){0===$(".object.polygon .icon-checkmark").length&&$("#poly_key_"+d).hide();for(var b=0,e=a[d].length;b<e;b++)try{a[d][b].setVisible(!1)}catch(f){a[d][b].setMap(null)}}} function initialize(a){console.time("initialize js chain until ready");setOptions();setAllControls();setMap();loadProgress(10);setInfoWindow();setCampusLayer();loadProgress(80);loadCategoryInfoFile(function(){populateCategoryInfo(function(){loadCategoryFile(function(){runPopulators(function(){bindCategoryToggle(function(){bindPolygonToggle(function(){bindMenuObjects(function(){typeToggle(function(){google.maps.event.addListenerOnce(map,"tilesloaded",function(){loadComplete();setMapHeight();openSingleBuilding(); bindSearch()})})})})})})})})});a&&"function"===typeof a&&a()}function openSingleBuilding(){if(window.location.hash){var a=window.location.hash.substr(1),a=getObjectIndexes(a);null!=a&&(openCategory($("#cat_"+a.cat+" .category_bar")[0]),markerArray[a.cat][a.obj].position?openObject(document.getElementById("obj_"+a.cat+"-"+a.obj)):openPolygon(document.getElementById("layer_cat_"+a.obj)),0==control.currentDevice&&toggleMenu())}} function resizeStack(){var a=detectDevice();setDevice(a,function(){setMapHeight()})}$win.resize(function(){clearTimeout(doResize);doResize=setTimeout(function(){resizeStack()},100)});$win.load(function(){initialize();$("#map_canvas").click(function(a){a.stopPropagation();a=control.currentDevice;$(this)!==$("#menu_button")&&1!==a&&setMenu(0)});$("#heading, #menu_button").click(function(a){a.stopPropagation();a.preventDefault();toggleMenu()})}); function getObjectIndexes(a){var d=mapCategories;try{if(""==a||null==a)throw"code can not be empty to find it";for(var c=!1,b=d.length,e={},f=0;f<b&&!1==c;f++)for(var h=d[f].length,k=0;k<h&&!1==c;k++)d[f][k].code===a&&(c=!0,e.cat=f,e.obj=k);if(c)return e;throw"could not find object";}catch(g){return console.log(g),null}};