function getHeight(e){return e.height()}function setHeight(e,t){e.style.height=t}function getMapHeight(){var e=$("body").height(),t=$("#title").height(),n=e-t+"px";return n}function setMapHeight(){$("#container").height(getMapHeight()),$("#map_canvas").height(getMapHeight())}function detectDevice(){var e=doc.body.offsetWidth;return e<800?0:1}function setDevice(e,t){var n=doc.getElementById("device_type"),r=doc.getElementsByTagName("body")[0];e===0?(control.currentDevice=0,r.setAttribute("id","mobile")):(control.currentDevice=1,r.setAttribute("id","desktop")),setMapHeight(),t&&typeof t=="function"&&t()}function toggleDevice(){var e=control.currentDevice;e===0?setDevice(1):setDevice(0)}function setCurrentDevice(){control.currentDevice===0?setDevice(0):setDevice(1)}function setAllControls(){var e=detectDevice();control.currentDevice=e,setCurrentDevice(),resizeStack()}function loadCategoryInfoFile(e){$.ajax({dataType:"json",url:categoryFile,success:function(e){categoryInfo=e}}).done(e).fail(function(){console.log("category ajax error")})}function loadCategoryFile(e){$.ajax({dataType:"json",url:objectFile,success:function(e){mapCategories=e}}).done(e).fail(function(){console.log("objects ajax error")})}function loadCatData(e){loadCategoryInfoFile(),loadCategoryFile(),e&&typeof e=="function"&&e()}function loadProgress(e,t){var n=doc.getElementById("loading_progress");n.style.width=e+"%",t&&typeof t=="function"&&t()}function loadComplete(e){loadProgress(100);var t=$("#loading"),n=control.currentDevice;t.fadeOut(1e3),e&&typeof e=="function"&&e(),console.timeEnd("initialize js chain until ready")}function createMarker(e,t,n,r){var i=new google.maps.Marker({position:new google.maps.LatLng(e,t),visible:!1,map:map,title:n,icon:r});return i}function buildCatObject(e,t,n,r){var i="";return i+='<a id="obj_'+t+"-"+e+'" class="object marker_object" name="'+n+'" href="#">',i+='<img  class="obj_icon" src="img/icons/numeral-icons/'+r+"/"+(e+1)+'.png" alt="'+n+'" />',i+='<div class="object_name">'+n+"</div>",i+="</a>",i}function createInfoWindow(e,t,n){google.maps.event.addListener(e,"click",function(){var r="",i=t.name,s,o=t.link,u=t.hours,a=t.phone,f=t.address,l=t.info,c=control.currentDevice;t.img&&(t.img.indexOf(":")===-1?s="img/objects/"+n+"/"+t.img:s=t.img),r+='<div class="infopane',c===0?r+=' infopane-mobile">':r+=' infopane-desktop">',r+="<h2>"+i+"</h2>",r+="<div>",s&&(r+='<img src="'+s+'" alt="'+i+'"',c===0?r+='width="100" height="75"':r+='width="200" height="150"',r+='style="float:right;margin:0 0 10px 10px"/>'),r+='<div class="button-div">',a&&(r+='<a class="phone-call btn btn-large btn-primary icon-call" href="tel:'+a+'" ></a>'),o&&(r+='<a href="'+o+'" target="_blank" class="btn btn-large btn-primary">More Info</a>'),r+="</div>",u&&(r+='<div class="info-row info-hours"><strong>Hours:</strong> '+u+"</div>"),a&&(r+='<div class="info-row info-phone"><strong>Phone:</strong> '+a+"</div>"),f&&(r+='<div class="info-row info-address"><strong>Address:</strong> '+f+"</div>"),l&&(r+='<div class="info-row info-info"><strong>Info:</strong> '+l+"</div>"),r+="</div>",infoWindow.setContent(r),infoWindow.open(map,e)})}function displayPoint(e){var t=google.maps.event.addListener(map,"moveend",function(){var n=map.fromLatLngToDivPixel(e.getPosition());google.maps.event.removeListener(t)});map.panTo(e.getPosition()),google.maps.event.trigger(e,"click")}function populateCategoryInfo(e){var t=doc.getElementById("categories"),n="",r=doc.getElementById("map_keys"),i=categoryInfo.length,s,o,u=0,a;while(u<i)s=categoryInfo[u],n+='<div class="category" id="cat_'+u+'">',categoryInfo[u].type===0?n+='<a class="category_bar" href="#" >':(n+='<a class="category_bar cat_polygon" href="#" >',r.innerHTML+='<div id="poly_key_'+u+'" class="map_key_category map_key_'+s.name+'"><div class="key_title">'+s.name+' Map Key</div><a href="#" class="close icon-cancel nolink"></a></div>'),n+='<img class="cat_icon" src="img/icons/blank-colors/'+s.icon+'.png" />',n+='<span class="category_name">'+s.title+"</span>",n+="</a>",n+='<div class="cat_container">',n+='<div class="cat_info">',n+="<p>",n+=s.text,n+="</p>",n+='<a href="'+s.link+'" target="_blank">'+s.title+" website</a>",n+="</div>",n+='<div id="category_'+u+'"></div>',n+="</div>",n+="</div>",control.categoryState[u]=0,u+=1;t.innerHTML=n,e&&typeof e=="function"&&e()}function populateObjectCategory(e,t){var n=document.getElementById("category_"+e),r="",i=categoryInfo[e],s=i.name,o=mapCategories[e],u=markerArray,a=[],f=i.icon,l,c=o.length,h=0,p,d,v,m,g;while(h<c)p=o[h],d=p.name,v=p.lat,m=p.lon,l=iconpath+f+"/"+(h+1)+".png",g=createMarker(v,m,d,l),r+=buildCatObject(h,e,d,f),createInfoWindow(g,p,s),a.push(g),h+=1;n.innerHTML=r,u[e]=a,t&&typeof t=="function"&&t()}function populatePolygonCategory(e,t){var n=doc.getElementById("category_"+e),r="",i=categoryInfo[e],s=mapCategories[e],o=$(".map_key_"+i.name),u=o.html(),a="",f,l,c=s.length,h=0,p,d,v,m=[];while(h<c)f=s[h],r+='<a class="object polygon" id="layer_cat_'+h+'" href="#">',r+='<div class="polygon_key" id="poly_'+f.name+'" style="border-color:'+f.borderColor+"; background-color:"+f.fillColor+'"><span>&nbsp;</span></div>',r+='<div class="object_name polygon">'+f.name+"</div>",r+="</a>",a+='<div class="polygon_key" id="poly_key_'+f.code+'" style="border-color:'+f.borderColor+"; background-color:"+f.fillColor+'">'+f.code+"</div>",v=mapCategories[e][h].map,d=new google.maps.KmlLayer(v,{suppressInfoWindows:!1,preserveViewport:!0}),m.push(d),h+=1;markerArray[e]=m,n.innerHTML=r,o.html(u+a),t&&typeof t=="function"&&t()}function toggleMarkerVisibility(e,t){var n=markerArray[e],r=n.length,i=0;if(t===1)while(i<r)n[i].setVisible(!0),i+=1;else while(i<r)n[i].setVisible(!1),i+=1}function togglePolygonVisibility(e,t,n,r){e=e.find("span");var i=markerArray[t][n],s=mapCategories[t][n].code,o=$(".map_key_"+categoryInfo[t].name),u=$("#map_keys #poly_key_"+s),a=e.hasClass("icon-checkmark");a===!0?(console.log("layer is active"),i.setMap(null),e.stop().toggleClass("icon-checkmark"),u.stop().toggleClass("active_key"),console.log("active keys = "+o.children(".active_key").length),o.children(".active_key").length<1&&o.stop().fadeOut()):(console.log("layer is inactive"),i.setMap(map),e.stop().toggleClass("icon-checkmark"),o.stop().fadeIn(),u.toggleClass("active_key")),r&&typeof r=="function"&&r()}function togglePolyKey(e){var t=$(".map_key_"+categoryInfo[e].name);t.stop().fadeToggle()}function setOptions(){myLatlng=new google.maps.LatLng(43.815045,-111.783515),myOptions={zoom:16,center:myLatlng,mapTypeId:google.maps.MapTypeId.HYBRID,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.TERRAIN]}}}function setMap(){map=new google.maps.Map(doc.getElementById("map_canvas"),myOptions)}function setInfoWindow(){infoWindow=new google.maps.InfoWindow}function setCampusLayer(){campusLayer=new google.maps.KmlLayer(campusFile,{suppressInfoWindows:!0,map:map,preserveViewport:!0,zoom:18}),campusLayer.setMap(map)}function runPopulators(e){var t=0,n=categoryInfo.length,r;while(t<n)r=categoryInfo[t].type,r===0?populateObjectCategory(t):r===1&&populatePolygonCategory(t),t+=1;e&&typeof e=="function"&&e()}function setMenu(e){var t=doc.getElementById("menu"),n=doc.getElementById("notification"),r=control.currentDevice;r!==0&&(t=$("#menu"),n=$("#notification")),e===0?(r===0?(t.style.display="none",n.style.display="block"):(t.stop().fadeOut(300),n.stop().fadeIn(300)),control.menuState=0):(r===0?(t.style.display="block",n.style.display="none"):(t.stop().fadeIn(300),n.stop().fadeOut(300)),control.menuState=1)}function toggleMenu(){var e=control.menuState;e===0?setMenu(1):setMenu(0)}function bindCategoryToggle(e){$(".category_bar").on("click",function(e){e.preventDefault(),infoWindow.close();var t=control.currentDevice,n=this.parentNode,r=n.id.substr(4),i=control.categoryState[r],s=n.children[1],o=s.style.display,u=$(this).hasClass("cat_polygon");t===1&&(s=$(this).next("div")),i===0?(t===0?s.style.display="block":s.slideToggle(200),u===!1&&toggleMarkerVisibility(r,1),i=1):(t===0?s.style.display="none":s.slideToggle(200),u===!1&&toggleMarkerVisibility(r,0),i=0),control.categoryState[r]=i}),e&&typeof e=="function"&&e()}function bindPolygonToggle(e){$(".object.polygon").click(function(e){e.stopPropagation(),e.preventDefault();var t=$(this),n=t.parent().attr("id").substr(9),r=t.attr("id").substr(10);togglePolygonVisibility(t,n,r)}),$(".close").click(function(e){e.stopPropagation(),e.preventDefault();var t=$(this).parent().attr("id").substr(9);togglePolyKey(t)}),e&&typeof e=="function"&&e()}function bindMenuObjects(e){$(".object.marker_object").click(function(e){e.stopPropagation(),e.preventDefault();var t=this,n=t.id.charAt(4),r=t.id.substr(6),i=markerArray[n][r],s=control.currentDevice;displayPoint(i),s===0&&setMenu(0)}),e&&typeof e=="function"&&e()}function typeToggle(e){google.maps.event.addListener(map,"maptypeid_changed",function(){document.getElementById("notification").className=map.getMapTypeId()}),e&&typeof e=="function"&&e()}function initialize(e){console.time("initialize js chain until ready"),setOptions(),setAllControls(),setMap(),loadProgress(10),setInfoWindow(),setCampusLayer(),loadProgress(80),loadCategoryInfoFile(function(){populateCategoryInfo(function(){loadCategoryFile(function(){runPopulators(function(){bindCategoryToggle(function(){bindPolygonToggle(function(){bindMenuObjects(function(){typeToggle(function(){google.maps.event.addListenerOnce(map,"tilesloaded",function(){loadComplete(),setMapHeight()})})})})})})})})}),e&&typeof e=="function"&&e()}function resizeStack(){var e=detectDevice();setDevice(e,function(){setMapHeight()})}var doc=document,win=window,$doc=$(document),$win=$(window),container=doc.getElementById("container"),body=doc.getElementsByTagName("body")[0],canvas=doc.getElementById("map_canvas"),doResize,categoryFile="data/categories.txt",objectFile="data/objectFile.txt",myLatlng,myOptions,map,parkingLayer,infoWindow,iconpath="img/icons/numeral-icons/",campusLayer,campusFile="http://www2.byui.edu/Map/campus_outline.xml",control={menuState:0,currentDevice:0,categoryState:[]},categoryInfo=[],mapCategories=[],markerArray=[];$win.resize(function(){clearTimeout(doResize),doResize=setTimeout(function(){resizeStack()},100)}),$win.load(function(){initialize(),$("#map_canvas").click(function(e){e.stopPropagation();var t=control.currentDevice;$(this)!==$("#menu_button")&&t!==1&&setMenu(0)}),$("#heading, #menu_button").click(function(e){e.stopPropagation(),e.preventDefault(),toggleMenu()}),$(document).keydown(function(e){e.keyCode===32&&toggleMenu()})});